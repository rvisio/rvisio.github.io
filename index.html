<html>
<head>
<meta charset=utf-8 />
<title>DC Census Tracts</title>
<meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
<script src='https://api.mapbox.com/mapbox.js/v2.3.0/mapbox.js'></script>
<link href='https://api.mapbox.com/mapbox.js/v2.3.0/mapbox.css' rel='stylesheet' />
 <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.css" />
  <script src="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>



<style>
  body { margin:0; padding:0; }
  #map { position:absolute; top:0; bottom:0; width:100%; }
</style>
</head>
<body>
	<div class="container">
	<div id='map' class="map leaflet-container leaflet-fade-anim" style="height:850px; position:relative;"></div>
	<div>


	<script>
		var geojson;


		var accessToken = 'pk.eyJ1IjoicnZpc2lvIiwiYSI6ImNpbGZlcWp5dzFyNGd2cm0weHNkYXFmZmkifQ._SdrpHeG4bGCe7ugGJTc2Q';
			// Replace 'mapbox.streets' with your map id.
			var mapboxTiles = L.tileLayer('https://api.mapbox.com/v4/mapbox.satellite/{z}/{x}/{y}.png?access_token=' +accessToken, {
		    attribution: '© <a href="https://www.mapbox.com/map-feedback/">Mapbox</a> © <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'

				});
			var map = L.map('map')
		    .addLayer(mapboxTiles)
		    .setView([38.9071923, -77.0368707], 12);

		$.getJSON("/census.json",function(response){
			$.getJSON('/unemployment.json', function(unempResponse){
					unempResponse.forEach(function(d){
						if (d.tract.toString().length == 3) {
							d.tr = "000" + d.tract;
						}else if (d.tract.toString().length==4) {
							d.tr = "00" + d.tract;
						}else if (d.tract.toString().length==5) {
							d.tr = "0" + d.tract;
						}
						var dd = response.features.filter(function(f){
							return f.properties.TRACT === d.tr
						})[0].properties.unempl = d.unempl




					})
				// console.log(unempResponse);
geojson = L.geoJson(response, {	
			style: function(feature) {
				return {
					fillColor: getColor(feature.properties.unempl),
					opacity:1,
					weight:2,
					color: 'white',
					dashArray:'3',
					fillOpacity: 0.7
				};
			},		
			onEachFeature: function (feature, layer) {
				
				console.log(unempResponse);
				layer.bindPopup("Tract: " + feature.properties.TRACT +"<br/>Unemployment Rate: " + feature.properties.unempl +'%'),
				layer.on({
					mouseover:highlightFeature,
					mouseout: resetHighlight,
					click: zoomToFeature
				});
			}
		}).addTo(map);
			console.log(response);

		})

				})

			
		

		function getColor(x) {
			return x < 3     ?    '#eff3ff':
         x <   6   ?   '#bdd7e7':
         x < 14   ?   '#6baed6':
         x < 17     ?   '#B0171F':
                          '#B0171F' ;
		};

		function highlightFeature(e){
			var layer = e.target;

			layer.setStyle({
				weight: 5,
				color: '#666',
				dashArray:'',
				fillOpacity :0.7
			})

			if (!L.Browser.ie && L.Browser.opera){
				layer.bringToFront();
			}
		}

		function resetHighlight(e){
			geojson.resetStyle(e.target);
		}

		function zoomToFeature(e) {
			map.fitBounds(e.target.getBounds())
		}

		var info = L.control();

		info.onAdd = function(map){
			this._div = L.DomUtil.create('div','info');
			this.update();
			return this._div;
		};

		info.update = function(props) {
			this._div.innerHTML
		}






</script>

	</body>

</head>

